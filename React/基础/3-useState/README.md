# ReactHook-useState

[react@18.2.0 å®˜æ–¹ä¸­æ–‡æ–‡æ¡£](https://react.docschina.org/reference/react/useState)

## 1. useState çš„å®šä¹‰

useState æ˜¯ React 16.8 å¼•å…¥çš„ Hooks APIï¼Œç”¨äºåœ¨å‡½æ•°ç»„ä»¶ä¸­ç®¡ç†çŠ¶æ€ã€‚

## 2.åŸºæœ¬è¯­æ³•

```js
const [state, setState] = useState(initialState);
```

**å‚æ•°**

- initialStateï¼šä»»æ„ç±»å‹çš„åˆå§‹å€¼ã€‚
  - ä»…åœ¨ç»„ä»¶é¦–æ¬¡æ¸²æŸ“æ—¶è¢«ä½¿ç”¨ï¼Œåç»­æ¸²æŸ“ä¼šå¿½ç•¥ã€‚
  - ä¸ºå‡½æ•°æ—¶åº”ä¸ºä¸æ¥æ”¶å‚æ•°çš„çº¯å‡½æ•°ï¼Œå¹¶åº”è¿”å›ä»»æ„ç±»å‹çš„å€¼ã€‚ï¼ˆ âš ï¸ ï¼šåœ¨ä¸¥æ ¼æ¨¡å¼ä¸­ï¼ŒReact å°†è°ƒç”¨ä¸¤æ¬¡åˆå§‹åŒ–å‡½æ•°ï¼Œä»¥å¸®ä½ æ‰¾åˆ°æ„å¤–çš„ä¸çº¯æ€§ã€‚è¿™åªæ˜¯å¼€å‘è¡Œä¸ºï¼Œä¸å½±å“ç”Ÿäº§ï¼‰
  - [ç‰¹æ€§-æƒ°æ€§åˆå§‹åŒ–](#3-1-æƒ°æ€§åˆå§‹åŒ–)

**è¿”å›**

- useState è¿”å›ä¸€ä¸ªç”±ä¸¤ä¸ªå€¼ç»„æˆçš„æ•°ç»„ï¼š[state, setState]ã€‚
  - stateï¼šå½“å‰çš„ stateï¼Œåœ¨é¦–æ¬¡æ¸²æŸ“æ—¶ï¼Œå®ƒå°†ä¸ä½ ä¼ é€’çš„ initialState ç›¸åŒ¹é…ã€‚
  - setStateï¼š[set å‡½æ•°](#2-1set-å‡½æ•°)ï¼Œå®ƒå¯ä»¥è®©ä½ å°† state æ›´æ–°ä¸ºä¸åŒçš„å€¼å¹¶è§¦å‘é‡æ–°æ¸²æŸ“ã€‚

```jsx
import { useState } from 'react';

function MyComponent() {
  // ä»»æ„ç±»å‹çš„initialState
  const [age, setAge] = useState(28);
  const [name, setName] = useState('Taylor');
  // å‡½æ•°ç±»å‹çš„initialStateï¼Œä»¥ä¸‹ä¸¤ç§å†™æ³•ç­‰ä»·
  const [todos, setTodos] = useState(() => createTodos());
  const [todos, setTodos] = useState(createTodos);
  // ...
```

âš ï¸ ï¼šuseState åªèƒ½åœ¨ç»„ä»¶é¡¶å±‚æˆ–è‡ªå®šä¹‰ Hook ä¸­è°ƒç”¨ï¼Œä¸èƒ½åœ¨å¾ªç¯æˆ–æ¡ä»¶è¯­å¥ä¸­è°ƒç”¨ï¼ˆå¦‚éœ€å¦‚æ­¤ï¼Œè¯·æå–ä¸€ä¸ªæ–°ç»„ä»¶å¹¶å°†çŠ¶æ€ç§»å…¥å…¶ä¸­ï¼‰ã€‚

### 2-1.set å‡½æ•°

useState è¿”å›çš„ set å‡½æ•°å…è®¸ä½ å°† state æ›´æ–°ä¸ºä¸åŒçš„å€¼å¹¶è§¦å‘é‡æ–°æ¸²æŸ“ã€‚ä½ å¯ä»¥ç›´æ¥ä¼ é€’æ–°çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥ä¼ é€’ä¸€ä¸ªæ ¹æ®å…ˆå‰çŠ¶æ€æ¥è®¡ç®—æ–°çŠ¶æ€çš„å‡½æ•°ã€‚

```jsx
setSomething(nextState);
```

**å‚æ•°**

- nextStateï¼šä½ æƒ³è¦ state æ›´æ–°ä¸ºçš„å€¼ã€‚å®ƒå¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„å€¼ï¼Œä½†å¯¹äºå‡½æ•°æœ‰ç‰¹æ®Šçš„è¡Œä¸ºã€‚
  - å¦‚æœä½ å°†å‡½æ•°ä½œä¸º nextState ä¼ é€’ï¼Œå®ƒå°†è¢«è§†ä¸ºæ›´æ–°å‡½æ•°ã€‚å®ƒå¿…é¡»æ˜¯çº¯å‡½æ•°ï¼Œåªæ¥å—å¾…å®šçš„ state ä½œä¸ºå…¶å”¯ä¸€å‚æ•°ï¼Œå¹¶åº”è¿”å›ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚ï¼ˆ [ç‰¹æ€§-å‡½æ•°å¼æ›´æ–°](#3-3-å‡½æ•°å¼æ›´æ–°)ï¼‰
  - React å°†æŠŠä½ çš„æ›´æ–°å‡½æ•°æ”¾å…¥é˜Ÿåˆ—ä¸­å¹¶é‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æœŸé—´ï¼ŒReact å°†é€šè¿‡æŠŠé˜Ÿåˆ—ä¸­æ‰€æœ‰æ›´æ–°å‡½æ•°åº”ç”¨äºå…ˆå‰çš„çŠ¶æ€æ¥è®¡ç®—ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚ï¼ˆ[ç‰¹æ€§-çŠ¶æ€æ‰¹å¤„ç†](#3-4-çŠ¶æ€æ‰¹å¤„ç†)ï¼‰

**è¿”å›**

- set å‡½æ•°æ²¡æœ‰è¿”å›å€¼ã€‚

```jsx
const [name, setName] = useState('Edward');

function handleClick() {
  setName('Taylor'); // ç›´æ¥ä¼ é€’æ–°çŠ¶æ€
  setAge(prevAge => prevAge + 1); // ä¼ é€’ä¸€ä¸ªæ ¹æ®å…ˆå‰çŠ¶æ€æ¥è®¡ç®—æ–°çŠ¶æ€çš„å‡½æ•°
  // ...
```

## 3.ç‰¹æ€§

### 3-1 æƒ°æ€§åˆå§‹åŒ–

å½“ initialState éœ€å¤æ‚è®¡ç®—æˆ–ä» localStorage å–å€¼ç­‰åœºæ™¯æ—¶å¯ä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼š

```jsx
// ğŸ™†æ¨èå†™æ³•ï¼šåªä¼šåœ¨ç»„ä»¶é¦–æ¬¡æ¸²æŸ“æ—¶æ‰§è¡Œä¸€æ¬¡initialStateFn
const [state, setState] = useState(initialStateFn);
const [state, setState] = useState(() => initialStateFn());

// ğŸ™…ä¸æ¨èå†™æ³•ï¼šä¼šå¯¼è‡´æ¯æ¬¡ç»„ä»¶æ¸²æŸ“æ—¶éƒ½è°ƒç”¨ä¸€æ¬¡initialStateFn
const [state, setState] = useState(initialStateFn());
```

### 3-2 å¼‚æ­¥æ€§

ä½¿ç”¨ set å‡½æ•°æ›´æ–°çŠ¶æ€ä¼šè§¦å‘ç»„ä»¶æ–°çš„æ¸²æŸ“ï¼Œä¸å½±å“æ­£åœ¨æ‰§è¡Œçš„å‡½æ•°ï¼Œå‡½æ•°å†…çš„ state ä»ä¸ºæ—§å€¼

```jsx
const [count, setCount] = useState(0);

const handleClick = () => {
	setCount(count + 1);
	console.log(count); // æ­¤æ—¶æ‰“å°çš„countä¸ºæ—§å€¼0
};
```

### 3-3 å‡½æ•°å¼æ›´æ–°

å½“æ–°çŠ¶æ€ä¾èµ–äºæ—§çŠ¶æ€æ—¶ï¼Œåº”ä½¿ç”¨å‡½æ•°å¼æ›´æ–°ç¡®ä¿åŸå­æ€§ï¼š

```jsx
// âœ…æ­£ç¡®ï¼šå‡½æ•°å¼æ›´æ–°
const increment = () => setCount((prevCount) => prevCount + 1);

// âŒé”™è¯¯ï¼šå¯èƒ½å¯¼è‡´ç«æ€æ¡ä»¶
const increment = () => setCount(count + 1);
```

### 3-4 çŠ¶æ€æ‰¹å¤„ç†

React é»˜è®¤ä¼šæ‰¹é‡å¤„ç†åŒä¸€äº‹ä»¶ä¸­çš„å¤šä¸ªçŠ¶æ€ï¼Œå†å†³å®šæ˜¯å¦åˆå¹¶æ›´æ–°ï¼š

```jsx
const handleClick = () => {
	setCount((c) => c + 1); // ä¸ä¼šç«‹å³æ›´æ–°
	setCount((c) => c + 1); // ä¸¤æ¬¡æ›´æ–°åˆå¹¶ä¸º +2
};
```

### 3-5 æ¯”è¾ƒåæ¸²æŸ“

useState é€šè¿‡ Object.is æ¯”è¾ƒæ–°æ—§çŠ¶æ€å†³å®šæ˜¯å¦æ¸²æŸ“ï¼Œç›´æ¥ä¿®æ”¹çŠ¶æ€ä¸ä¼šè§¦å‘æ¸²æŸ“ï¼š

```jsx
// âœ…æ­£ç¡®ï¼šåˆ›å»ºæ–°å¯¹è±¡
setUser({ ...user, age: 31 });

// âŒé”™è¯¯ï¼šç›´æ¥ä¿®æ”¹çŠ¶æ€
const [user, setUser] = useState({ name: "John", age: 30 });
user.age = 31; // ä¸ä¼šè§¦å‘æ¸²æŸ“
```

### 3-6 é—­åŒ…é™·é˜±

è‹¥å› å‡½æ•°å†…çš„å¼‚æ­¥å›è°ƒå¼•ç”¨äº†å¤–éƒ¨çš„ state å½¢æˆé—­åŒ…ï¼Œå¼‚æ­¥æ—¶é—´å†…è¯¥ state å‘ç”Ÿå˜åŒ–ï¼Œç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œæ­¤æ—¶é—­åŒ…å†…çš„ state ä¼šä»ä¸ºæ—§å€¼ï¼š

```jsx
const [count, setCount] = useState(0);

const handleClick = () => {
	setTimeout(
		// å›è°ƒå‡½æ•°å¼•ç”¨äº†å¤–éƒ¨çš„countå˜é‡ï¼Œå½¢æˆäº†é—­åŒ…ã€‚
		() => {
			console.log(count); // è‹¥æ­¤æ—¶countå‘ç”Ÿå˜åŒ–ï¼Œç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œè¯¥countä¼šä»ä¸ºæ—§å€¼
		},
		1000
	);
};
```

è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ useRef ä¿å­˜æœ€æ–°å€¼

```jsx
const countRef = useRef(count);
countRef.current = count;

const handleClick = () => {
	setTimeout(() => {
		console.log(countRef.current); // å§‹ç»ˆè·å–æœ€æ–°å€¼
	}, 1000);
};
```
